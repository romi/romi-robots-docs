# Evaluate a phyllotaxis measurement (case1) Use sm-dtw with simulated data

How to use the 'sm-dtw' assessment tool with simulated synthetic phyllotaxis data


## Related Materials:
* Download and view the full **[tutorial video](https://zenodo.org/record/6793459#.YsKmMXjP0Uk)**. See also [below](Tutorial_sm-dtw_simulatephyllotaxis.md#outline-of-the-tutorial-video) how to navigate rapidely into the content of this video.

* **related readme** procedure: you can also help by reading the readme of the [project](https://github.com/fabfabBesnard/Phyllotaxis-sim-eval/blob/main/docker/docker_readme.md).

## Objective
- generate synthetic data to use the sm-dtw program
- use sm-dtw
- evaluate the prediction made by sm-dtw

## Prerequisite
you only need to install [docker](https://docs.docker.com/desktop/#download-and-install). No other third-party software (R, python, jupyter, conda) is required, as all the programs are run from inside the docker container

## Step-by-step tutorial
## 1. Download the docker image
It should be downloaded automatically when trying to run the docker for the first time

```
docker run -p 8888:8888 -it roboticsmicrofarms/sm-dtw_demo:latest bash
```

## 2. Using jupyter notebook inside a docker:
### Running the Jupyter notebook:
1. In your **local machine**, create a working directory to store the results generated by the notebook. It will be mounted inside the container, where its name will be "docker_sandbox". The name in you local machine can be identical or different, but keep the name inside the docker to avoid further changes in the notebooks. Sop open a terminal and type: 

```
mkdir docker_sandbox # this folder can be created anywhere in your local machine
cd docker_sandbox # Move into this working directory
```   

2. Start the container:

```
docker run -v $(pwd):/myapp/docker_sandbox -p 8888:8888 -it roboticsmicrofarms/sm-dtw_demo:latest bash
```
*Note*: you can start this command from anywhere in your local machine by correctly mapping the mounted volume in the string before the semi-column (`-v path/in/your/machine:/myapp/docker_sandbox`) 

3. **Inside the container**, serve the notebooks by entering the following command after the running container's prompt (which should be something like: `(dtw) root@aa7632c1fc29:/myapp#`):

```
jupyter notebook Phyllotaxis-sim-eval/notebooks/docker_run --ip 0.0.0.0 --no-browser --allow-root
```

4.  Outside the docker, start your browser
5. enter the url with token:"http://127.0.0.1:8888/?token=....." or directly Ctrl+click on it
6. select the correct kernel (R, dtw or bash, as indicated in the first cell of the notebook)
7. run the notebook !

## Outline of the tutorial video
Here is the main content of the video and indicative time to help you directly jump into the chapters you are interested in !

| Chapter                                               | Time start | Content description                                                                                                                                |
|-------------------------------------------------------|------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| Introduction                                          | 00min 00s  | Romi Project, object of this video                                                                                                                 |
| Content Outline                                       | 00min 30s  | details the content of the video                                                                                                                   |
| What is sm-dtw ?                                      | 1min 05s   | general description of sm-dtw program                                                                                                              |
| Why/when do I need 'sm-dtw'                           | 2min 40s   | Presents the precise example of our use for phyllotaxis measurement in Romi and propose other possible user cases                                  |
| Where to find online written documentation            | 8min15     | provides a link to the 'readme' page of the github repo of the project                                                                             |
| Docker & Jupyter notebooks                            | 8min 47    | Download and start docker + start Jupyter Notebooks Prepare a working folder to store your data on your local machine                              |
| Step1 (1st Jupyter notebook)                          | 12min 12s  | Explains how to simulate synthetic data made of a sequence of reference phyllotaxis data (angles and internodes) a test sequence containing errors |
| Step2 (2nd Jupyter notebook)                          | 28min 15s  | Explains how to realignthe two phyllotaxis sequences generated in step1 using sm-dtw                                                               |
| Step3 (3rd Jupyter notebook)                          | 39min 11s  | Explains how to check that the alignment prediction made by sm-dtw correspond to the errors generated in step1                                     |
| Quit and close Jupyter notebooks and docker container | 51min 20s  | proper procedure to close and quit jupyter notebooks and the docker container.                                                                     |