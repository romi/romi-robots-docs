How to see directly the results of your plant phenotyping with the `plant-3d-explorer` ?
================================

## Objective
Throughout the whole process of plant phenotyping, viewing data is often needed.
This tutorial explains how to use the romi `plant-3d-explorer`, a web-server tool, to explore, display and interact with most of the diverse data generated during a typical plant phenotyping experiment from 2D images (2D images, 3D objects like meshes or point cloud, quality evaluations, trait measurements).
After this tutorial, you should be able to:
* connect the plant-3d-explorer to a database containing the phenotyping data of one to several plants ;
* explore the database content with the `plant-3d-explorer` menu page ;
* For each plant, display, overlay and inspect in 3d every data generated during analysis

## Prerequisite
* install romi `plant-3d-explorer` (from [source](https://github.com/romi/plant-3d-explorer) or using a [docker image](../docker/plant3dexplorer_docker.md) ) & read [install procedure](../install/plant3dexplorer_setup.md) 
* install romi `plantdb` (from [source](https://github.com/romi/plantdb) or using a [docker image](../docker/romidb_docker.md)) & read [install procedure](../install/romidb_setup.md)
* install romi `plant-3d-vision` (from [source](https://github.com/romi/plant-3d-vision) or using a [docker image](../docker/plantinterpreter_docker.md)) & read [install procedure](../install/plant_reconstruction_setup.md)
* Create and activate isolated python environment (see the procedure [here](/docs/Scanner/install/create_env.md) )

!!! note
    using **docker**
    <img src="/assets/images/ext/docker_logo2.png" alt="docker_logo" width="50">

    You can avoid installs by using **docker** only. Read first the docker procedures ( ['docker for plant-3d-vision'](../docker/plantinterpreter_docker.md) and
    ['docker-compose to run both database and 3d explorer with docker containers'](../docker/docker_compose.md) ). In the following tutorial (steps 1, 2 and 3), follow the docker logo to adapt the procedure.
  
## Linked documentation
* [Manual of the romi plant-3d-explorer](/docs/plant_3d_explorer/index.md)

## Step-by-step tutorial
Principle: the `plant-3d-explorer` is a web client that displays in your favorite web browser data exposed by a server (here, romi `plantdb`) on a particular url. The process consists in pointing the server to your folder of interest, starting the server and starting the client that points to the served url. 

!!!note
    the `plant-3d-explorer` has only been developed and tested on Chrome.


### 1.  Preparing your database for display by the `plant-3d-explorer`
**Starting point:** your *database* is made of one or several *datasets*, which all correspond to a single plant phenotyping experiment: each dataset contains at least 2D images (raw acquisitions) and metadata, and possibly several other data generated by subsequent 3D reconstruction, segmentation and analysis.

!!! Note

    Your database must follow the rules of romi databases: please make sure that you comply to [requirements](../install/romidb_setup/#initialize-a-romi-database).

    You can also download an example database [here](https://db.romi-project.eu/models/test_db.tar.gz).

*example*: let's consider a database called `my_experiment` containing 3 datasets (named plant1, plant2, plant3) generated by phenotyping three plants.

* open a terminal and go to your local database directory
* if romi commands (like `romi_run_task`) are not accessible from your terminal, activate the appropriate python environment (e.g. using venv or conda) required for romi commands (or [read this procedure](../install/create_env.md))
* Process all datasets for display by the `plant-3d-explorer` by running the following code
  
```bash
dataset_list=('plant1','plant2','plant3')

for ds in "${dataset_list[@]}"
do 
    romi_run_task Visualization path_to/my_experiment/"$ds"/ --config ~/config/ml_pipe_real.toml
done
```
!!! Note
    For more information about using romi_run_task command, the Visualization task and the config file, please read XXXXX.

!!! Note
    <img src="/assets/images/ext/docker_logo2.png" alt="docker_logo" width="50"> *for docker users*

    - Start a docker container by mounting your database as a volume ([details](../docker/plantinterpreter_docker.md/#manually))
    
    - In the container, run the same Visualization Task has above

**check result**: a new folder called `Visualization` should have been created in each dataset of your database

!!! Note
    <img src="/assets/images/ext/docker_logo2.png" alt="docker_logo" width="50"> *for docker users*
    Skip step 2 & 3 and follow instead instructions given by['docker-compose to run both database and 3d explorer with docker containers'](../docker/docker_compose.md)

### 2. Connect your database to a local server
- Continue in the same shell terminal (if you open a new terminal, do not forget to activate appropriate python environment)
- set the DB location using the `DB_LOCATION` environment variable 
- Type the following commands to launch the server:
```bash
export DB_LOCATION=/path/to/your/db
romi_scanner_rest_api #command that starts the server
```
**check result**: the terminal prints various information given by the server (e.g. number of datasets in the database). Do not stop this terminal as this will shut down the server

### 3. Connect the `plant-3d-explorer` to the server
- Open a new terminal 
- go to your local cloned directory of `plant-3d-explorer/`
- start the frontend visualization server by entering:
```bash
npm start
```
You should now be able to access the `plant-3d-explorer` on [http://localhost:3000](http://localhost:3000). Depending on you system preferences, your default web browser may automatically open a window displaying the server content. if not, open your web browser and enter [http://localhost:3000](http://localhost:3000) in the url bar.

!!! note
    You need to add a file `.env.local` at project's root to set the API URL: ```REACT_APP_API_URL='{`API URL}'```.
    Without this, the app will use: http://localhost:5000 which is the default for `romi_scanner_rest_api`.

### 4.  Explore your database content via the menu page
The starting page of the `plant-3d-explorer` lists the datasets of the connected database as a table and looks like this:
 <img src="/assets/images/plant-3d-explorer/plant3dexplorer_menupage.png" alt="plant3dexplorer_menupage" width="1000">

 * The top search bar allows you to find particular datasets based on keywords.
 * Data filters: in the header row, click on an icon to activate the filter (datasets that do *not* contain the data will be filtered out)

<img src="/assets/images/plant-3d-explorer/plant3dexplorer_availabledata.png" alt="availdata" width="100"> 3d objects generated from the plant 2D images (respectively: mesh, point cloud, segmented point cloud, skeleton and organs)

 <img src="/assets/images/plant-3d-explorer/plant3dexplorer_phyllotaxisfilter.png" alt="phyllofilter" width="100"> or phyllotaxis data (manual or computed phyllotaxis measurements)

 * Open a dataset with the green 'Open' button at the far right of a row <img src="/assets/images/plant-3d-explorer/plant3dexplorer_openbutton.png" alt="openbutton" width="100">

### 5.  View all data related to a single dataset
describe how to display the main interesting data from a dataset.