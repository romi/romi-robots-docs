
# Documentation for Cablebot v2

## Hardware

The cablebot uses two Raspberry Pis, one for the base station and one
for the camera.

The PI's should be running the the 64-bit version of Raspberry Pi OS
Lite.

The user "romi" should be configured on both devices. All the software will be installed in the home directory of the romi user, /home/romi. 


## Software

The software is part of the romi-rover-build-and-test repository. It
consists of three separate applications that communicate with each
other over websockets:

* rcom-registry: A directory service that keeps track of the addresses of the applications
* romi-camera: The interface to the camera
* oquam: The interface to any CNC-style device for motion 


### Base station

On the Raspberry Pi that runs the base stattion:

* Clone romi-rover-build-and-test
* Compile rcom-registry and oquam
* Install Python API
* Copy the config file
* Test the applications


To clone the repo, do:

```sh
$ cd /home/romi
$ git clone --branch ci_dev --recurse-submodules https://github.com/romi/romi-rover-build-and-test.git
$ cd romi-rover-build-and-test
$ mkdir build
$ cd build
```

To compile:

```sh
$ mkdir build
$ cd build
$ cmake ..
$ make rcom-registry oquam
```

Install the Python API:

```sh
$ cp /home/romi/romi-rover-build-and-test/librcom/python
$ pip install --editable .
$ cp /home/romi/romi-rover-build-and-test/python
$ pip install --editable .
```

Copy the config file:
```sh
$ cp /home/romi/romi-rover-build-and-test/config/cablebot-v2.json /home/romi/config.json 
```

Open a terminal and run:
```sh
$ /home/romi/romi-rover-build-and-test/build/bin/rcom-registry 
```

You should see something like:
```sh
Registry server running at 172.20.10.3:10101
```


You should see something like:
```sh
Registry server running at 172.20.10.3:10101
```


Open a terminal and run:
```sh
$ /home/romi/romi-rover-build-and-test/build/bin/oquam --config /home/romi/config.json 
```

You should see a bunch of messages, and also the path of the log file:
```sh
...
Changing log to '/tmp/romi/log.txt'
...
```



You can test the CNC interface through the Python API:
```sh
$ cd /home/romi/romi-rover-build-and-test/python
$ python3 camera.py
```




### Camera module

On the Raspberry Pi that runs the camera:

* Clone romi-rover-build-and-test
* Compile romi-camera
* Copy the config file
* Test the camera
* Add the camera app to the start-up script

To clone the repo, do:

```sh
$ cd /home/romi
$ git clone --branch ci_dev --recurse-submodules https://github.com/romi/romi-rover-build-and-test.git
$ cd romi-rover-build-and-test
$ mkdir build
$ cd build
```

To compile romi-camera:

```sh
$ mkdir build
$ cd build
$ cmake ..
$ make romi-camera
```

Copy the config file:
```sh
$ cp /home/romi/romi-rover-build-and-test/config/cablebot-v2.json /home/romi/config.json 
```

Open a terminal and run:
```sh
$ /home/romi/romi-rover-build-and-test/build/bin/romi-camera --config /home/romi/config.json --directory /home/romi
```

You should see a bunch of messages, and also the path of the log file:
```sh
...
Changing log to '/tmp/romi/log.txt'
...
```

You can always check that log file for more info.

In the terminal that runs rcom-registry, you should see (IP and port numbers will differ):

```sh
INFO: RegistryServer: Received message: {"request": "register", "topic": "camera", "address": "172.20.10.3:55229"}
INFO: RegistryServer: Register topic 'camera' at 172.20.10.3:55229
```

On the base station, you can test the camera interface through the Python API:
```sh
$ cd /home/romi/romi-rover-build-and-test/python
$ python3 camera.py
```

It should store 10 images on the disk, named camera-xxxx.jpg.





